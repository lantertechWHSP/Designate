# Soul Patts (By Designate)

## Summary
    Soul Patts uses the following stack
    * React
    * NextJS
    * Vercel
    * DatoCMS

## Running code on your local machine
1) Run `npm install`
2) Run `npm run dev`
   * Note: ensure that you have the appropraite .env variables and a .env file in place. Refer to the .env.example for the variables.
3) Open localhost: `http://localhost:3000`

## DatoCMS Build Triggers & Webhooks
Soul Patts has build triggers and webhooks that are wired up to both Vercel and Gitlab. By extension Gitlab CI/CD deploys code to the Lanter server.
The structure can be seen as such

DatoCMS --> Gitlab --> Server (Lanter)
DatoCMS --> Vercel

You can refer to the documentation for each item
Vercel: https://www.datocms.com/marketplace/hosting/vercel
Gitlab: https://www.datocms.com/marketplace/hosting/gitlab (Note we only use the Gitlab CI/CD to listen to triggers and deploy code in the Lanter server)

## Gitlab CI/CD & Server (from Lanter)
For Soul Patts, the NextJS solution is hosted on a Server maintained by Lanter. The .gitlab-ci.yml essentially builds the NextJS .next directory, tunnels into the Server, drops the appropriate files and restarts the NextJs App.

## Environments
A list of sites where you can examine the code:

staging : Uses the /staging branch in Vercel: https://whsp-staging.vercel.app
pre-prod: Uses the /master branch in Vercel: https://whsp-preprod.vercel.app
production: Uses the /master branch in the Lanter server: https://soulpatts.com.au

## Admin Site
To edit the content simply go to https://soulpatts.admin.datocms.com/
Note: When editing content, make sure you are in the correct environment

## Directory Files & Structures Overview
/dato: API queries to communicate with DatoCMS
/consts: Utility constants
/interfaces: Annotated object types to make sense of the data. (Consider having portions of this generated by DatoCMS down the road.)
/components: 
   /blocks: Blocks that render the content of the DatoCMS Blocks
   /elements: General components used throughout the site
   /layouts: Template layouts for the site
   /site: Sitewide components
   ModularContent.tsx: Import all Blocks here to render the content. Renders the list of blocks
   StruturedContent.tsx: Container for the DatoCMS StructuredText object: https://www.datocms.com/docs/react/structured-text-fields
/app
   _fonts.tsx: Load the fonts server side to prevent FOUT
/assets
   /fonts: Keep the fonts private
/lib: Various functions
/pages: Pages on the site
